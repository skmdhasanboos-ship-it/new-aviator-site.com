<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aviator Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --aviator-red: #d11d33;
            --bg-dark: #121314;
            --panel-bg: #1b1c1d;
            --btn-green: linear-gradient(180deg, #28a745 0%, #1e7e34 100%);
            --btn-yellow: linear-gradient(180deg, #ffc107 0%, #e0a800 100%);
            --ref-green: #00ff88;
        }

        body { margin: 0; background: var(--bg-dark); font-family: 'Roboto', sans-serif; color: white; display: flex; flex-direction: column; align-items: center; overflow-x: hidden; user-select: none; }

        .helpline-btn { position: fixed; bottom: 20px; right: 20px; background: #0088cc; color: white; padding: 10px 18px; border-radius: 50px; text-decoration: none; font-weight: bold; font-size: 14px; z-index: 4000; box-shadow: 0 4px 15px rgba(0,0,0,0.5); display: flex; align-items: center; gap: 8px; border: 1px solid rgba(255,255,255,0.2); cursor: move; touch-action: none; }

        #authOverlay { position: fixed; inset: 0; background: #121314; z-index: 5000; display: flex; align-items: center; justify-content: center; }
        .auth-card { background: #1b1c1d; width: 90%; max-width: 400px; padding: 30px; border-radius: 15px; border: 1px solid var(--aviator-red); text-align: center; }
        .auth-card h2 { color: var(--aviator-red); margin-bottom: 20px; font-weight: 900; }
        .auth-card input { width: 100%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid #444; color: white; border-radius: 5px; box-sizing: border-box; }
        .auth-card button { background: var(--aviator-red); color: white; border: none; padding: 12px; width: 100%; border-radius: 5px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .auth-card p { font-size: 13px; color: #888; margin-top: 15px; }
        .auth-link { color: var(--ref-green); cursor: pointer; text-decoration: underline; }
        .game-title-auth { font-size: 28px; font-weight: 900; color: var(--aviator-red); margin-bottom: 15px; font-style: italic; }

        .history-bar { width: 100%; background: #141516; padding: 6px 10px; display: flex; gap: 8px; overflow-x: auto; border-bottom: 1px solid #333; min-height: 35px; align-items: center; white-space: nowrap; scrollbar-width: none; }
        .history-bar::-webkit-scrollbar { display: none; }
        .hist-item { font-size: 11px; font-weight: bold; padding: 3px 12px; border-radius: 15px; background: #222; color: #34b4ff; border: 1px solid #333; }
        .hist-high { color: #913ef8; }

        .header { width: 100%; padding: 10px 15px; display: grid; grid-template-columns: 1fr 1fr 1fr; align-items: center; background: #1b1c1d; border-bottom: 1px solid #333; box-sizing: border-box; }
        .menu-btn { background: none; border: none; color: #ccc; font-size: 24px; cursor: pointer; justify-self: start; }
        .brand-name { color: var(--aviator-red); font-weight: 900; font-style: italic; font-size: 20px; text-align: center; }
        .balance-box { color: #00ff88; font-weight: bold; background: #000; padding: 5px 10px; border-radius: 20px; border: 1px solid #333; font-size: 13px; justify-self: end; }

        .display-card { width: 95%; max-width: 450px; height: 210px; background: radial-gradient(circle, #2c2d30 0%, #000 100%); border-radius: 12px; position: relative; margin: 10px 0; overflow: hidden; border: 1px solid #333; }
        #plane { position: absolute; bottom: 20px; left: -100px; width: 65px; z-index: 10; }
        .multiplier { position: absolute; width: 100%; top: 35%; text-align: center; font-size: 55px; font-weight: 900; z-index: 5; }

        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); overflow-y: auto; }
        .modal-content { background: #1b1c1d; margin: 5% auto; padding: 20px; width: 90%; max-width: 450px; border-radius: 15px; border: 1px solid var(--aviator-red); text-align: center; }
        .modal input, .modal select { width: 90%; padding: 12px; margin: 10px 0; background: #000; border: 1px solid #444; color: #00ff88; border-radius: 5px; }
        .modal button { background: var(--aviator-red); border: none; color: white; padding: 12px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 10px; }
        .close-modal { float: right; cursor: pointer; font-size: 24px; color: #888; }

        .ref-container { background: #1b1c1d; border: 2px dashed var(--ref-green); border-radius: 12px; padding: 15px; text-align: left; margin: 20px 0; }
        .ref-header { display: flex; align-items: center; gap: 8px; color: var(--ref-green); font-weight: bold; font-size: 14px; margin-bottom: 8px; }
        .ref-link-display { font-size: 10px; color: #888; word-break: break-all; display: block; margin-bottom: 12px; line-height: 1.4; }
        .copy-ref-btn { background: var(--ref-green) !important; color: black !important; font-weight: 900 !important; border-radius: 5px !important; padding: 10px !important; font-size: 14px !important; }

        .bet-container { width: 95%; max-width: 450px; display: flex; flex-direction: column; gap: 10px; padding-bottom: 20px; }
        .bet-panel { background: var(--panel-bg); border-radius: 15px; padding: 12px; border: 1px solid #333; }
        .tab-row { display: flex; background: #000; border-radius: 20px; padding: 2px; width: 120px; margin: 0 auto 12px; }
        .tab { flex:1; text-align:center; font-size:11px; padding:5px; border-radius:20px; cursor:pointer; color:#888; }
        .tab.active { background:#323336; color:white; }
        .auto-section { display: none; margin-bottom: 12px; padding: 10px; background: #141516; border-radius: 10px; }
        .auto-section.active { display: block; }
        .auto-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-size: 12px; }
        .switch { position: relative; width: 36px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background: #444; transition: .3s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background: white; transition: .3s; border-radius: 50%; }
        input:checked + .slider { background: #28a745; }
        input:checked + .slider:before { transform: translateX(16px); }
        .main-controls { display: flex; gap: 12px; align-items: center; }
        .plus-minus { display: flex; align-items: center; background: #000; border-radius: 25px; border: 1px solid #444; padding: 3px 10px; flex: 1; }
        .plus-minus input { background: transparent; border: none; color: white; text-align: center; width: 100%; font-weight: bold; outline: none; font-size: 16px; }
        .plus-minus button { background: #333; color: white; border: none; width: 26px; height: 26px; border-radius: 50%; cursor: pointer; }
        .quick-bet-row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .quick-btn { background: #222; border: 1px solid #333; color: #ccc; padding: 5px; border-radius: 10px; font-size: 12px; cursor: pointer; font-weight: bold; }
        .btn-main { flex: 1.3; height: 75px; border-radius: 15px; border: none; color: white; font-weight: 800; background: var(--btn-green); cursor: pointer; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .btn-main.cashout-active { background: var(--btn-yellow) !important; color: black !important; }
        .btn-main.waiting-mode { background: #444 !important; color: #aaa !important; cursor: default; }
        .copy-box { background: #000; padding: 10px; border-radius: 5px; margin: 10px 0; display: flex; justify-content: space-between; align-items: center; border: 1px solid #333; }
        .copy-btn { background: #333; color: #00ff88; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; }
        .req-card { background: #000; border: 1px solid #333; padding: 10px; border-radius: 8px; margin-bottom: 10px; text-align: left; font-size: 13px; color: #fff; }
        .req-btn-group { display: flex; gap: 10px; margin-top: 10px; }
        .approve-btn { background: #28a745 !important; flex: 1; height: 35px; color: white; border: none; border-radius: 5px; }
        .cancel-btn { background: #d11d33 !important; flex: 1; height: 35px; color: white; border: none; border-radius: 5px; }
        .history-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 12px; }
        .history-table th, .history-table td { border: 1px solid #333; padding: 8px; text-align: center; }
        .status-Approved { color: #00ff88; }
        .status-Pending { color: #ffc107; }
        .status-Cancelled { color: #ff4444; }
        .side-menu { position: fixed; top: 0; left: -260px; width: 260px; height: 100%; background: #111; z-index: 1000; transition: 0.3s; padding: 20px; box-sizing: border-box; }
        .side-menu.active { left: 0; }
        .menu-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.7); display: none; z-index: 999; }
        .menu-overlay.active { display: block; }
        .menu-item { padding: 15px; border-bottom: 1px solid #222; cursor: pointer; font-size: 16px; }
    </style>
</head>
<body onload="init()">

    <a href="http://avaitor-game-live-support-dcr9.vercel.app" target="_blank" class="helpline-btn" id="helplineBtn">
        <span>üéß Helpline</span>
    </a>

    <div id="authOverlay">
        <div class="auth-card" id="loginBox">
            <h2>LOGIN</h2>
            <input type="text" id="logPhone" placeholder="Phone Number">
            <input type="password" id="logPass" placeholder="Password">
            <div class="game-title-auth">AVIATOR GAME</div>
            <button onclick="handleLogin()">LOGIN</button>
            <p>Don't have an account? <span class="auth-link" onclick="toggleAuth(false)">Register</span></p>
        </div>
        <div class="auth-card" id="regBox" style="display:none">
            <h2>REGISTER</h2>
            <input type="text" id="regPhone" placeholder="Phone Number">
            <input type="password" id="regPass" placeholder="Password">
            <input type="password" id="regConfirm" placeholder="Confirm Password">
            <input type="text" id="regRef" placeholder="Refer Code (Optional)">
            <div class="game-title-auth">AVIATOR GAME</div>
            <button onclick="handleReg()">REGISTER</button>
            <p>Already have an account? <span class="auth-link" onclick="toggleAuth(true)">Login</span></p>
        </div>
    </div>

    <div class="history-bar" id="history-signals"></div>

    <div class="header">
        <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
        <div class="brand-name">Aviator</div>
        <div class="balance-box">‡ß≥ <span id="balance">0.00</span></div>
    </div>

    <div class="display-card">
        <div class="multiplier" id="mult-text">1.00x</div>
        <img src="https://files.catbox.moe/ivtc82.png" id="plane" alt="Plane">
    </div>

    <div id="depModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModals()">&times;</span>
            <h3 style="color:var(--aviator-red); margin-bottom: 5px;">DEPOSIT</h3>
            <p style="color: #28a745; font-weight: bold; font-size: 14px; margin: 0 0 10px 0;">üí∏ 30% Deposit Bonus üí∏</p>
            <p style="font-size: 12px; color: #888;">Min Deposit: ‡ß≥80</p>
            <select id="depMethod" onchange="updateDepNumbers()">
                <option value="Bkash">Bkash</option>
                <option value="Nagad">Nagad</option>
            </select>
            <div class="copy-box"><span id="activeDepNum">Bkash: 01933098049</span><button class="copy-btn" onclick="copyDepNumber()">COPY</button></div>
            <input type="number" id="depAmt" placeholder="Amount (Min 80)">
            <input type="text" id="trxId" placeholder="TrxID">
            <button onclick="submitDeposit()">SUBMIT REQUEST</button>
            <h4 style="margin-top:20px; border-top: 1px solid #333; padding-top:10px;">Deposit History</h4>
            <div id="depHistoryList"></div>
        </div>
    </div>

    <div id="withModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModals()">&times;</span>
            <h3 style="color:var(--aviator-red)">WITHDRAW</h3>
            <p style="font-size: 12px; color: #888;">Min Withdraw: ‡ß≥100</p>
            <select id="withMethod"><option value="Bkash">Bkash</option><option value="Nagad">Nagad</option></select>
            <input type="number" id="withAmt" placeholder="Amount (Min 100)">
            <input type="text" id="withNum" placeholder="Account Number">
            <button onclick="submitWithdraw()">SUBMIT REQUEST</button>
            <h4 style="margin-top:20px; border-top: 1px solid #333; padding-top:10px;">Withdraw History</h4>
            <div id="withHistoryList"></div>
        </div>
    </div>

    <div id="adminModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModals()">&times;</span>
            <h3 style="color:var(--aviator-red)">ADMIN PANEL</h3>
            <div id="adminLogin">
                <input type="password" id="adminPass" placeholder="Password">
                <button onclick="checkAdmin()">LOGIN</button>
            </div>
            <div id="adminDashboard" style="display:none">
                <h4 style="border-bottom:1px solid #333; padding-bottom:5px">Pending Requests</h4>
                <div id="requestList"></div>
                <button style="background:#555; color:white; border:none; padding:10px; width:100%; border-radius:5px;" onclick="clearAllData()">Reset All Data</button>
            </div>
        </div>
    </div>

    <div id="refModal" class="modal">
        <div class="modal-content" style="border:none; text-align: left; background: transparent;">
            <span class="close-modal" onclick="closeModals()" style="color:white; float:right;">&times;</span>
            <h1 style="color:var(--ref-green); font-size: 38px; margin: 0; font-weight: 900;">Menu</h1>
            <div class="ref-container">
                <div class="ref-header">üîó Referral Link (5% Bonus)</div>
                <span id="refLink" class="ref-link-display"></span>
                <button class="copy-ref-btn" onclick="copyText(document.getElementById('refLink').innerText)">COPY REFERRAL LINK</button>
                <div style="margin-top: 15px; color: white; font-size: 14px; border-top: 1px solid #333; padding-top: 10px;">
                    <p>Total Refers: <span id="totalRef" style="color: var(--ref-green);">0</span></p>
                    <p>Total Bonus: <span id="totalBonus" style="color: var(--ref-green);">‡ß≥0.00</span></p>
                </div>
            </div>
        </div>
    </div>

    <div class="bet-container">
        <div class="bet-panel" id="panel1">
            <div class="tab-row"><div class="tab active" onclick="setTab(1, 'bet')">Bet</div><div class="tab" onclick="setTab(1, 'auto')">Auto</div></div>
            <div class="auto-section" id="auto1">
                <div class="auto-row"><span>Auto Bet</span><label class="switch"><input type="checkbox" id="ab1"><span class="slider"></span></label></div>
                <div class="auto-row"><span>Auto Cashout</span><label class="switch"><input type="checkbox" id="ac1"><span class="slider"></span></label><input type="number" id="acv1" value="2.00" step="0.1" style="width:45px; background:#000; border:1px solid #444; text-align:center; color:#00ff88;"></div>
            </div>
            <div class="main-controls">
                <div style="flex:1">
                    <div class="plus-minus"><button onclick="chAmt(1, -10)">-</button><input type="number" id="amt1" value="10.00"><button onclick="chAmt(1, 10)">+</button></div>
                    <div class="quick-bet-row">
                        <button class="quick-btn" onclick="setFixedAmt(1, 30)">30</button>
                        <button class="quick-btn" onclick="setFixedAmt(1, 50)">50</button>
                        <button class="quick-btn" onclick="setFixedAmt(1, 100)">100</button>
                        <button class="quick-btn" onclick="setFixedAmt(1, 200)">200</button>
                    </div>
                </div>
                <button class="btn-main" id="btn1" onclick="handleBet(1)">BET <span>10.00 BDT</span></button>
            </div>
        </div>
        <div class="bet-panel" id="panel2">
            <div class="tab-row"><div class="tab active" onclick="setTab(2, 'bet')">Bet</div><div class="tab" onclick="setTab(2, 'auto')">Auto</div></div>
            <div class="auto-section" id="auto2">
                <div class="auto-row"><span>Auto Bet</span><label class="switch"><input type="checkbox" id="ab2"><span class="slider"></span></label></div>
                <div class="auto-row"><span>Auto Cashout</span><label class="switch"><input type="checkbox" id="ac2"><span class="slider"></span></label><input type="number" id="acv2" value="2.00" step="0.1" style="width:45px; background:#000; border:1px solid #444; text-align:center; color:#00ff88;"></div>
            </div>
            <div class="main-controls">
                <div style="flex:1">
                    <div class="plus-minus"><button onclick="chAmt(2, -10)">-</button><input type="number" id="amt2" value="10.00"><button onclick="chAmt(2, 10)">+</button></div>
                    <div class="quick-bet-row">
                        <button class="quick-btn" onclick="setFixedAmt(2, 30)">30</button>
                        <button class="quick-btn" onclick="setFixedAmt(2, 50)">50</button>
                        <button class="quick-btn" onclick="setFixedAmt(2, 100)">100</button>
                        <button class="quick-btn" onclick="setFixedAmt(2, 200)">200</button>
                    </div>
                </div>
                <button class="btn-main" id="btn2" onclick="handleBet(2)">BET <span>10.00 BDT</span></button>
            </div>
        </div>
    </div>

    <div class="menu-overlay" id="overlay" onclick="toggleMenu()"></div>
    <div class="side-menu" id="sideMenu">
        <h2 style="color:var(--aviator-red)">MENU</h2>
        <div class="menu-item" onclick="openModal('depModal')">üí∞ Deposit</div>
        <div class="menu-item" onclick="openModal('withModal')">üèß Withdraw</div>
        <div class="menu-item" onclick="openModal('refModal')">üîó Referral</div>
        <div class="menu-item" onclick="openModal('adminModal')">üõ† Admin Panel</div>
        <div class="menu-item" onclick="handleLogout()">üö™ Logout</div>
    </div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
    const firebaseConfig = { databaseURL: "https://aviatorpro-e7334-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const _0xkey1 = "YXZpX2JhbA=="; 
    const _0xadm = "aGFzYW5qY2QwMzc1"; 
    const _0xhist = "YXZpX2dhbWVfaGlzdA=="; 
    const _0xusr = "YXZpX3VzZXJz"; 
    const _0xses = "YXZpX3Nlc3Npb24="; 
    function _d(s){return atob(s);}

    let balance = parseFloat(localStorage.getItem(_d(_0xkey1))) || 0.00;
    let gameHistory = JSON.parse(localStorage.getItem(_d(_0xhist))) || [];
    let isFlying = false;
    let multiplier = 1.00;
    let crashPoint = 0;
    let bets = { 1: { active: false, waiting: false, amt: 0 }, 2: { active: false, waiting: false, amt: 0 } };

    // ‡¶π‡ßá‡¶≤‡ßç‡¶™‡¶≤‡¶æ‡¶á‡¶® ‡¶¨‡¶æ‡¶ü‡¶® ‡¶°‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ó‡¶ø‡¶Ç ‡¶≤‡¶ú‡¶ø‡¶ï
    const dragBtn = document.getElementById("helplineBtn");
    let isDragging = false;
    let offset = { x: 0, y: 0 };

    function startDrag(e) { 
        isDragging = true; 
        const clX = e.type === 'touchstart' ? e.touches[0].clientX : e.clientX; 
        const clY = e.type === 'touchstart' ? e.touches[0].clientY : e.clientY; 
        offset.x = clX - dragBtn.offsetLeft; 
        offset.y = clY - dragBtn.offsetTop; 
    }

    function doDrag(e) { 
        if (!isDragging) return; 
        e.preventDefault(); 
        const clX = e.type === 'touchmove' ? e.touches[0].clientX : e.clientX; 
        const clY = e.type === 'touchmove' ? e.touches[0].clientY : e.clientY; 
        dragBtn.style.left = (clX - offset.x) + 'px'; 
        dragBtn.style.top = (clY - offset.y) + 'px'; 
        dragBtn.style.right = 'auto'; 
        dragBtn.style.bottom = 'auto'; 
    }

    function stopDrag() { isDragging = false; }

    dragBtn.addEventListener('mousedown', startDrag); 
    dragBtn.addEventListener('touchstart', startDrag);
    window.addEventListener('mousemove', doDrag); 
    window.addEventListener('touchmove', doDrag, { passive: false });
    window.addEventListener('mouseup', stopDrag); 
    window.addEventListener('touchend', stopDrag);

    function init() {
        const session = localStorage.getItem(_d(_0xses));
        if(session) {
            document.getElementById('authOverlay').style.display = 'none';
            loadReferData(session);
        }
        refreshUI(); renderSavedHistory(); startCycle();
    }

    function refreshUI() { 
        document.getElementById('balance').innerText = balance.toFixed(2); 
        localStorage.setItem(_d(_0xkey1), balance);
        localStorage.setItem(_d(_0xhist), JSON.stringify(gameHistory));
        renderUserHistory();
    }

    // --- ‡¶°‡¶ø‡¶™‡ßã‡¶ú‡¶ø‡¶ü ‡¶ì ‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï ---
    function submitDeposit() {
        let amt = parseFloat(document.getElementById('depAmt').value);
        let trx = document.getElementById('trxId').value;
        let userPh = localStorage.getItem(_d(_0xses));
        if(amt >= 80 && trx) {
            let id = Date.now();
            db.ref('requests/' + id).set({
                id: id, type: 'DEP', amt: amt, info: trx, 
                method: document.getElementById('depMethod').value, 
                status: 'Pending', user: userPh
            }).then(() => { alert("Deposit Request Sent!"); closeModals(); });
        } else alert("Enter Amount (Min 80) and TrxID");
    }

    function submitWithdraw() {
        let amt = parseFloat(document.getElementById('withAmt').value);
        let num = document.getElementById('withNum').value;
        let userPh = localStorage.getItem(_d(_0xses));
        if(amt >= 100 && num && balance >= amt) {
            balance -= amt; refreshUI();
            let id = Date.now();
            db.ref('requests/' + id).set({
                id: id, type: 'WITH', amt: amt, info: num, 
                method: document.getElementById('withMethod').value, 
                status: 'Pending', user: userPh
            }).then(() => { alert("Withdraw Request Sent!"); closeModals(); });
        } else alert("Insufficient Balance or Min 100");
    }

    // --- ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï (‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶ì ‡¶∞‡¶ø‡¶´‡¶æ‡¶®‡ßç‡¶° ‡¶†‡¶ø‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá) ---
    function manageFirebaseReq(key, action) {
        db.ref('requests/' + key).once('value').then((snap) => {
            let r = snap.val();
            if(!r || r.status !== 'Pending') return;

            let currentSessionUser = localStorage.getItem(_d(_0xses));

            if(action === 'Approve') {
                if(r.type === 'DEP') {
                    let bonus = r.amt * 0.30;
                    let totalToAdd = r.amt + bonus;
                    if(r.user === currentSessionUser) {
                        balance += totalToAdd; refreshUI();
                    }
                }
                db.ref('requests/' + key).update({ status: 'Approved' });
            } else {
                if(r.type === 'WITH') {
                    if(r.user === currentSessionUser) {
                        balance += r.amt; refreshUI(); // ‡¶∞‡¶ø‡¶´‡¶æ‡¶®‡ßç‡¶°
                    }
                }
                db.ref('requests/' + key).update({ status: 'Cancelled' });
            }
        });
    }

    // --- ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßá‡¶Æ ‡¶≤‡¶ú‡¶ø‡¶ï ---
    function loadReferData(userPh) {
        let myCode = "REF" + userPh.slice(-4);
        document.getElementById('refLink').innerText = window.location.origin + window.location.pathname + "?ref=" + myCode;
        
        db.ref('users/' + userPh + '/referStats').on('value', (snap) => {
            let data = snap.val() || { count: 0, bonus: 0 };
            document.getElementById('totalRef').innerText = data.count;
            document.getElementById('totalBonus').innerText = "‡ß≥" + data.bonus.toFixed(2);
        });
    }

    function handleReg() {
        let ph = document.getElementById('regPhone').value;
        let ps = document.getElementById('regPass').value;
        let refUsed = document.getElementById('regRef').value;
        let users = JSON.parse(localStorage.getItem(_d(_0xusr))) || [];

        if(ph.length < 10) return alert("Invalid Phone");
        
        if(refUsed.includes("REF")) {
            db.ref('refer_map/' + refUsed).once('value').then((snap) => {
                let parentUser = snap.val();
                if(parentUser) {
                    db.ref('users/' + parentUser + '/referStats').transaction((curr) => {
                        let c = curr || { count: 0, bonus: 0 };
                        return { count: c.count + 1, bonus: c.bonus + 5 }; // ‡ß´ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏
                    });
                }
            });
        }

        let myRef = "REF" + ph.slice(-4);
        db.ref('refer_map/' + myRef).set(ph);
        
        users.push({ ph: ph, ps: ps });
        localStorage.setItem(_d(_0xusr), JSON.stringify(users));
        localStorage.setItem(_d(_0xses), ph);
        location.reload();
    }

    // --- ‡¶π‡ßá‡¶≤‡ßç‡¶™‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®‡¶∏‡¶Æ‡ßÇ‡¶π ---
    function renderAdminRequests() {
        let list = document.getElementById('requestList'); list.innerHTML = "";
        db.ref('requests').on('value', (snap) => {
            list.innerHTML = "";
            let data = snap.val();
            for(let key in data) {
                let req = data[key];
                if(req.status === 'Pending') {
                    let div = document.createElement('div'); div.className = "req-card";
                    div.innerHTML = `<b>${req.type}</b> - ${req.user}<br>Amt: ${req.amt} | ${req.info}
                    <div class="req-btn-group">
                        <button class="approve-btn" onclick="manageFirebaseReq('${key}', 'Approve')">Approve</button>
                        <button class="cancel-btn" onclick="manageFirebaseReq('${key}', 'Cancel')">Reject</button>
                    </div>`;
                    list.appendChild(div);
                }
            }
        });
    }

    function renderUserHistory() {
        let dH = document.getElementById('depHistoryList'); let wH = document.getElementById('withHistoryList');
        if(!dH || !wH) return;
        let userPh = localStorage.getItem(_d(_0xses));
        db.ref('requests').orderByChild('user').equalTo(userPh).on('value', (snap) => {
            let data = snap.val();
            let dTable = `<table class="history-table"><tr><th>Amt</th><th>Trx/Num</th><th>Status</th></tr>`;
            let wTable = dTable;
            for(let key in data) {
                let r = data[key];
                let row = `<tr><td>${r.amt}</td><td>${r.info}</td><td class="status-${r.status}">${r.status}</td></tr>`;
                if(r.type === 'DEP') dTable += row; else wTable += row;
            }
            dH.innerHTML = dTable + "</table>"; wH.innerHTML = wTable + "</table>";
        });
    }

    // --- ‡¶ó‡ßá‡¶Æ ‡¶á‡¶û‡ßç‡¶ú‡¶ø‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï ---
    function startCycle() {
        isFlying = false; multiplier = 1.00;
        crashPoint = (Math.random() * 3.5 + 1.02).toFixed(2);
        let t = 5; document.getElementById('plane').style.left = "-100px";
        for(let i=1;i<=2;i++) {
            if(document.getElementById('ab'+i).checked && balance >= parseFloat(document.getElementById('amt'+i).value)) {
                let v = parseFloat(document.getElementById('amt'+i).value); balance -= v; bets[i].amt = v; bets[i].active = true;
            }
            if(bets[i].waiting) { bets[i].active = true; bets[i].waiting = false; }
            refreshBtn(i);
        }
        refreshUI();
        let cd = setInterval(() => { if(t > 0) document.getElementById('mult-text').innerText = t--; else { clearInterval(cd); launch(); } }, 1000);
    }

    function launch() {
        isFlying = true;
        let loop = setInterval(() => {
            multiplier += 0.01;
            document.getElementById('mult-text').innerText = multiplier.toFixed(2) + "x";
            document.getElementById('plane').style.left = (multiplier * 22) + "px";
            for(let i=1; i<=2; i++) {
                if(bets[i].active) {
                    document.getElementById('btn'+i).className = "btn-main cashout-active";
                    document.getElementById('btn'+i).innerHTML = `CASHOUT <span>${(bets[i].amt * multiplier).toFixed(2)}</span>`;
                    if(document.getElementById('ac'+i).checked && multiplier >= parseFloat(document.getElementById('acv'+i).value)) doCash(i);
                }
            }
            if(multiplier >= crashPoint) {
                clearInterval(loop); isFlying = false; addHistory(multiplier.toFixed(2));
                document.getElementById('mult-text').innerText = "FLEW AWAY!";
                for(let i=1; i<=2; i++) { bets[i].active = false; refreshBtn(i); }
                setTimeout(startCycle, 3000);
            }
        }, 50);
    }

    function addHistory(v) { gameHistory.unshift(v); if(gameHistory.length > 20) gameHistory.pop(); renderSavedHistory(); }
    function renderSavedHistory() { document.getElementById('history-signals').innerHTML = gameHistory.map(v => `<div class="hist-item ${v>=2?'hist-high':''}">${v}x</div>`).join(''); }
    function handleBet(p) {
        let v = parseFloat(document.getElementById('amt'+p).value);
        if(!isFlying) { if(!bets[p].active) { if(balance >= v) { balance -= v; bets[p].amt = v; bets[p].active = true; } } else { balance += bets[p].amt; bets[p].active = false; } }
        else { if(bets[p].active) doCash(p); else { if(balance >= v) { balance -= v; bets[p].amt = v; bets[p].waiting = true; } } }
        refreshBtn(p); refreshUI();
    }
    function doCash(p) { balance += (bets[p].amt * multiplier); bets[p].active = false; refreshBtn(p); refreshUI(); }
    function refreshBtn(p) {
        let b = document.getElementById('btn'+p); let v = document.getElementById('amt'+p).value;
        if(bets[p].waiting) { b.className="btn-main waiting-mode"; b.innerHTML="WAITING..."; }
        else { b.className=bets[p].active?"btn-main waiting-mode":"btn-main"; b.innerHTML=bets[p].active?"CANCEL":`BET <span>${v} BDT</span>`; }
    }
    function chAmt(p, v) { let i = document.getElementById('amt'+p); i.value = Math.max(1, parseFloat(i.value) + v).toFixed(2); refreshBtn(p); }
    function setFixedAmt(p, v) { document.getElementById('amt'+p).value = v.toFixed(2); refreshBtn(p); }
    function setTab(p, m) { document.getElementById('auto'+p).classList.toggle('active', m==='auto'); }
    function toggleAuth(isLogin) { document.getElementById('loginBox').style.display = isLogin ? 'block' : 'none'; document.getElementById('regBox').style.display = isLogin ? 'none' : 'block'; }
    function handleLogin() {
        let ph = document.getElementById('logPhone').value; let ps = document.getElementById('logPass').value;
        let users = JSON.parse(localStorage.getItem(_d(_0xusr))) || [];
        let user = users.find(u => u.ph === ph && u.ps === ps);
        if(user) { localStorage.setItem(_d(_0xses), ph); location.reload(); } else alert("Wrong Login!");
    }
    function handleLogout() { localStorage.removeItem(_d(_0xses)); location.reload(); }
    function updateDepNumbers() { const m = document.getElementById('depMethod').value; document.getElementById('activeDepNum').innerText = m === "Bkash" ? "Bkash: 01933098049" : "Nagad: 01765943426"; }
    function copyDepNumber() { navigator.clipboard.writeText(document.getElementById('activeDepNum').innerText.split(': ')[1]); alert("Copied!"); }
    function toggleMenu() { document.getElementById('sideMenu').classList.toggle('active'); document.getElementById('overlay').classList.toggle('active'); }
    function openModal(id) { toggleMenu(); document.getElementById(id).style.display = "block"; if(id==='adminModal') renderAdminRequests(); }
    function closeModals() { document.querySelectorAll('.modal').forEach(m => m.style.display = "none"); }
    function copyText(t) { navigator.clipboard.writeText(t); alert("Copied!"); }
    function checkAdmin() { if(document.getElementById('adminPass').value === _d(_0xadm)) { document.getElementById('adminLogin').style.display = "none"; document.getElementById('adminDashboard').style.display = "block"; renderAdminRequests(); } else alert("Denied!"); }
    function clearAllData() { localStorage.clear(); location.reload(); }
</script>
</body>
</html>
